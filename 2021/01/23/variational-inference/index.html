<!DOCTYPE html> <html> <head> <!-- Global site tag (gtag.js) - Google Analytics --> <!-- Thanks to Paul Cochrane: https://ptc-it.de/enabling-cookie-consent-with-jekyll-minimal-mistakes/ --> <script async src="https://www.googletagmanager.com/gtag/js?id=G-M32X5EGH2D"></script> <script> function initialiseGAOnConsent() { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-M32X5EGH2D', { 'anonymizeIp': true, 'cookie_expires': 0, 'store_gac': false }); }; </script> <meta charset="utf-8"> <meta name="apple-mobile-web-app-capable" content="yes"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title> Basics of variational inference - theory | Ozan √ñƒüreden </title> <meta name="description" content=" Personal homepage. "> <meta name="keywords" content="Ozan √ñƒüreden, personal homepage"> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <!-- Social: Facebook / Open Graph --> <meta property="og:type" content="article"> <meta property="article:author" content="Ozan √ñƒüreden"> <meta property="article:section" content="writing"> <meta property="article:tag" content=""> <meta property="article:published_time" content="2021-01-23 00:00:00 -0600"> <meta property="og:url" content="https://ozan.ogreden.com/2021/01/23/variational-inference/"> <meta property="og:title" content=" Basics of variational inference - theory | Ozan √ñƒüreden "> <meta property="og:image" content="https://ozan.ogreden.com"> <meta property="og:description" content=" Personal homepage. "> <meta property="og:site_name" content="Ozan √ñƒüreden"> <meta property="og:locale" content="en_US"> <!-- Social: Twitter --> <meta name="twitter:card" content="summary_large_image"> <meta name="twitter:site" content="oguzhanogreden"> <meta name="twitter:title" content=" Basics of variational inference - theory | Ozan √ñƒüreden "> <meta name="twitter:description" content=" Personal homepage. "> <meta name="twitter:image:src" content="https://ozan.ogreden.com"> <!-- Social: Google+ / Schema.org --> <meta itemprop="name" content=" Basics of variational inference - theory | Ozan √ñƒüreden "> <meta itemprop="description" content=" Personal homepage. "> <meta itemprop="image" content="https://ozan.ogreden.com"> <!-- Canonical link tag --> <link rel="canonical" href="https://ozan.ogreden.com/2021/01/23/variational-inference/"> <link rel="alternate" type="application/rss+xml" title="Ozan √ñƒüreden" href="https://ozan.ogreden.com/feed.xml"> <!-- rel prev and next --> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" /> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/tex-mml-chtml.js"> </script> </head> <body> <main class="wrapper"> <header class="site-header"> <nav class="nav"> <div class="container"> <h1 class="logo"> <a href="https://ozan.ogreden.com/" >Ozan √ñƒüreden<span></span></a > </h1> <ul class="navbar"> <li> <a href="/cv">CV</a> </li> </ul> </div> </nav> </header> <article class="post container" itemscope itemtype="http://schema.org/BlogPosting"> <!-- don't show titles on zettels --> <header class="post-header"> <p class="post-meta"><time datetime="2021-01-23T00:00:00-06:00" itemprop="datePublished">Jan 23, 2021</time></p> <h1 class="post-title" itemprop="name headline">Basics of variational inference - theory</h1> </header> <div class="post-content" itemprop="articleBody"> <hr /> <p><em>Friendly reminder of <a href="/2020/12/05/montaigne-warning/">Montaigne's warning</a> and <a href="/2021/01/08/writing/">why I write</a>.</em> <hr /> <br> <p>I recently attempted fitting a <a href="/2021/01/08/dirichlet-processes-label-switching/">Dirichlet process mixture model</a> <!-- [[202012161651 dirichlet process post]] --> using PyMC3. It wasn‚Äôt a very succesful attempt, I ran into some difficulties due to label switching. The speed of NUTS sampler for the Dirichlet process mixture model kept me from trying different settings to solve this, and here we are, looking for an alternative.</p> <p>The alternative is already there, it‚Äôs called variational inference (VI). It is a method for approximating probability densities <!-- [[202101121750 Variational Inference A Review For Statisticians]] -->. In Bayesian modeling, we can use it to approximate the posterior and consider it an alternative to markov chain monte carlo (MCMC) algorithms. There is one important advantage of VI: it‚Äôs blazing fast compared to MCMC. And there is an important disadvantage: you don‚Äôt get to be sure that the approximation will give you what you‚Äôre looking for.</p> <p>Let‚Äôs start with remembering what we‚Äôre looking for in Bayesian inference problem: the posterior, or the density of model parameters conditional on the data. Mathematically speaking:</p> \[p(z | x)\] <p>Commonly used modern methods for getting to the posterior are based on sampling, a.k.a markov chain monte carlo algorithms. VI, on the other hand, approaches the problem from an optimisation point of view, by making use of a clever trick. Before we get to the trick, let‚Äôs take a look at the objective of the optimisation: Kullbeck-Leibler (KL) divergence <!-- [[202101121805 Kullbeck-Leibler divergence]] -->.</p> <p>The Kullbeck-Leibler divergence is a measure if the ‚Äúdifference in information contained within two distributions‚Äù <sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote">1</a></sup>. In the VI context, specifically, the KL divergence from the posterior to the approximating density is relevant: \(KL( q(\mathbf{z}) \| p(\mathbf{z} \vert \mathbf{x} ) )\)</p> <p>Buried in this divergence is a term that‚Äôs very difficult to evaluate: \(p(\boldsymbol{x})\). The clever trick I mentioned above walks around this difficulty, by optimising for another objective, which is (1) easier to evaluate and (2) is equivalent to minimising the KL divergence: Evidence lower bound (ELBO).</p> \[ELBO(q) = \mathbb{E}[logp(\mathbf{z}, \mathbf{x})] - \mathbb{E}[logq(\mathbf{z})]\] <p>Blei et al. (2018) note that ‚Äúthe variational objective mirrors the usual balance between likelihood and prior‚Äù <sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote">2</a></sup> <!-- [[202101121750 Variational Inference A Review For Statisticians]] --> and this is visible once the identity is rearranged:</p> \[ELBO(q) = \mathbb{E}[logp(\mathbf{x}|\mathbf{z})] + KL(q(\mathbf{z})||p(\mathbf{z}))\] <p>Great. But how do we specify \(q\)? A commonly used family of probability distributions is ‚Äúmean-field variational family‚Äù. The mean-field variational family is essentially a joint distribution of independent random variables. So we say that</p> \[q(\boldsymbol{z}) = \prod_{j=1}^{m}q_j(z_j).\] <p>This makes one of the key properties of VI with mean-field family clear: <strong>we‚Äôre assuming that prior parameters are mutually independent</strong>. If they are correlated, the approximation will not be able to capture that information.</p> <p>Now, we need an optimisation algorithm and we‚Äôre ready to go. I‚Äôll refer you to Blei et al. (2018) <sup id="fnref:2:1" role="doc-noteref"><a href="#fn:2" class="footnote">2</a></sup> for the details, where you can read about coordinate ascent mean-field variational inference.</p> <p>Now let‚Äôs turn to what‚Äôs happening when we use the <a href="https://docs.pymc.io/notebooks/variational_api_quickstart.html">variational API of PyMC3</a>. <a href="https://github.com/pymc-devs/pymc3/blob/aedc8e9006c7e672e461774a5ee095562405c99c/pymc3/variational/inference.py#L732-L741">Here</a> you can see that the default of the <code class="language-plaintext highlighter-rouge">method=</code> parameter is ADVI (automatic differentiation variational inference). ADVI is an algorithm that can express a given probabilistic model as an optimisation problem. The significant advantage of it is that we don‚Äôt have to think about technical requirements that we need to satisfy to make the approximation work. Any model we can write in PyMC3 (also Stan) can be run through ADVI.</p> <p>Equipped with the magic provided by PyMC3 and with a basic understanding of variational inference. It‚Äôs time to see it in practice!</p> <div class="footnotes" role="doc-endnotes"> <ol> <li id="fn:1" role="doc-endnote"> <p>https://ermongroup.github.io/cs228-notes/inference/variational/¬†<a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p> </li> <li id="fn:2" role="doc-endnote"> <p>https://arxiv.org/abs/1601.00670¬†<a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a>¬†<a href="#fnref:2:1" class="reversefootnote" role="doc-backlink">&#8617;<sup>2</sup></a></p> </li> </ol> </div> </div> </article> <footer class="site-footer"> <div class="container"> <small class="block" >&copy; 2021 Ozan √ñƒüreden &middot; Powered by <a href="https://jekyllrb.com/">Jekyll</a> and <a href="https://github.com/heiswayi/thinkspace" >Thinkspace theme</a ></small > </div> </footer> </main> <!-- Thanks to osano.com for the open source version! --> <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script> <script> window.cookieconsent.initialise({ "palette": { "popup": { "background": "#0086b3", "text": "#ffffff" }, "button": { "background": "transparent", "text": "#ffffff", "border": "#ffffff" } }, "type": "opt-in", "content": { "message": "Hi! üëã I'd like to know what you are reading using a Google Analytics cookie. Are you fine with this?", "allow": "Okay!", "deny": "No.", "link": "I do care about (your) privacy.", "href": "privacy" }, "cookie": { "secure": true, "domain": "oguzhanogreden.com" }, onInitialise: function (status) { var type = this.options.type; var didConsent = this.hasConsented(); if (type == 'opt-in' && didConsent) { initialiseGAOnConsent(); } if (type == 'opt-out' && !didConsent) { } }, onStatusChange: function(status, chosenBefore) { var type = this.options.type; var didConsent = this.hasConsented(); if (type == 'opt-in' && didConsent) { initialiseGAOnConsent(); } if (type == 'opt-out' && !didConsent) { } }, onRevokeChoice: function() { var type = this.options.type; if (type == 'opt-in') { } if (type == 'opt-out') { initialiseGAOnConsent(); } } }); </script> </body> </html>
